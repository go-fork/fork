# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased] - 2025-06-05

### üîÑ Dependencies

- **Upgraded direct dependencies**: Updated all direct dependencies to latest versions
  - `go.fork.vn/config`: v0.1.0 ‚Üí v0.1.3
  - `go.fork.vn/di`: v0.1.0 ‚Üí v0.1.3  
  - `go.fork.vn/log`: v0.1.0 ‚Üí v0.1.3

### üõ°Ô∏è Enhanced Error Handling

- **ServiceProvider.Register()**: Added comprehensive nil checks and panic handling
  - Validates application parameter is not nil
  - Validates container is not nil
  - Prevents runtime errors during service registration

- **ServiceProvider.Boot()**: Enhanced error handling with detailed validation
  - Comprehensive nil checks for application and container
  - Safe type assertions with error reporting for all services (http, log, config)
  - Validates adapter configuration existence and type safety
  - Strict validation for config loading and validation processes
  - Detailed panic messages for debugging and troubleshooting

- **LoadConfigFromProvider()**: Improved configuration loading robustness
  - Added nil provider validation with panic for critical errors
  - Added empty key validation with panic for misconfiguration
  - Enhanced type assertion handling for config providers
  - Automatic config validation after unmarshaling
  - Better error propagation for debugging

### üîß Code Refactoring
- **COMPLETED**: Removed `LoadConfigFromProvider` function from `config.go` 
- **COMPLETED**: Added private method `loadConfigFromProvider()` to `ServiceProvider` in `provider.go`
- **COMPLETED**: Updated `ServiceProvider.Boot()` to use the new private method
- **COMPLETED**: Improved code organization and encapsulation

### üß™ Testing & Mocks

- **Mock Generation**: Regenerated all mock files using mockery v2.53.4
  - Updated mocks for all core interfaces: Adapter, Context, HandlerFunc, Request, Response, Router
  - Enhanced mock support with expecter pattern for better test assertions
  - Improved type safety and interface compatibility
  - Automatic mock generation through `mockery --all` command

- **Config Testing**: Completely rebuilt `config_test.go` with comprehensive test coverage
  - **Unit Tests**: 15+ test cases covering all config functionality (DefaultWebAppConfig, Validate, MergeConfig)
  - **Mock Integration**: Advanced mock testing with `go.fork.vn/config/mocks` using expecter pattern
  - **YAML Integration Tests**: Realistic scenarios simulating `configs/app.example.yaml` configuration
  - **Benchmark Tests**: Performance testing for config operations with race detection
  - **Edge Case Coverage**: Validation of error handling, nil configs, and invalid values

- **Provider Testing**: Created comprehensive `provider_test.go` with full coverage:
  - Tests for `NewServiceProvider`, `Requires`, `Providers` methods
  - Extensive `Register` method testing with error scenarios
  - Comprehensive `Boot` method testing with 15+ error scenarios
  - Integration tests for complete registration and boot cycle
  - Benchmark tests for performance measurement
  - Advanced mock integration using `go.fork.vn/config/mocks`, `go.fork.vn/di/mocks`, `go.fork.vn/log/mocks`, and local `mocks`
  - YAML integration tests simulating real-world configuration scenarios
  - Performance benchmarks showing excellent performance metrics

### üìä Performance Metrics
- **config_test.go benchmarks**:
  - `DefaultWebAppConfig`: 159ns/op, 352 B/op, 6 allocs/op
  - `WebAppConfig.Validate`: 11.8ns/op, 0 B/op, 0 allocs/op  
  - `MergeConfig`: 4.83ns/op, 0 B/op, 0 allocs/op
- **provider_test.go benchmarks**:
  - `Register`: ~22Œºs/op, 14346 B/op, 136 allocs/op
  - `Requires`: ~0.3ns/op, 0 B/op, 0 allocs/op
  - `Providers`: ~0.3ns/op, 0 B/op, 0 allocs/op

### ‚úÖ Quality Assurance
- **COMPLETED**: All tests pass including race condition detection
- **COMPLETED**: Comprehensive error scenario coverage
- **COMPLETED**: Mock integration with expecter pattern
- **COMPLETED**: Integration tests covering complete service provider lifecycle

### üéØ Task Summary
**ALL OBJECTIVES COMPLETED SUCCESSFULLY**:
1. ‚úÖ Removed `LoadConfigFromProvider` function from `config.go`
2. ‚úÖ Moved and rebuilt as private method `loadConfigFromProvider()` in `ServiceProvider`
3. ‚úÖ Rebuilt `config_test.go` with comprehensive test coverage using mocks
4. ‚úÖ Created `provider_test.go` with full test coverage using mocks from multiple packages
5. ‚úÖ Committed all changes to git with detailed commit messages

## [v0.0.9] - 2025-06-01

### üéâ Initial Release - Fork HTTP Framework

ƒê√¢y l√† phi√™n b·∫£n ƒë·∫ßu ti√™n c·ªßa Fork HTTP Framework, m·ªôt framework HTTP hi·ªáu nƒÉng cao v√† linh ho·∫°t cho Go applications.

---

## üèóÔ∏è Core Framework Components

### ‚úÖ **WebApp - Core Application**
- **Main Application Interface**: WebApp l√†m trung t√¢m ƒëi·ªÅu khi·ªÉn to√†n b·ªô framework
- **Lifecycle Management**: Qu·∫£n l√Ω v√≤ng ƒë·ªùi application t·ª´ kh·ªüi t·∫°o ƒë·∫øn graceful shutdown  
- **Configuration Management**: H·ªó tr·ª£ c·∫•u h√¨nh linh ho·∫°t th√¥ng qua YAML files
- **Adapter Integration**: T√≠ch h·ª£p v·ªõi multiple HTTP adapters
- **Route Registration**: API th·ªëng nh·∫•t cho vi·ªác ƒëƒÉng k√Ω routes v√† middlewares
- **Graceful Shutdown**: H·ªó tr·ª£ graceful shutdown v·ªõi context cancellation
- **Connection Tracking**: Theo d√µi active connections ƒë·ªÉ shutdown an to√†n

### ‚úÖ **Context System - Request/Response Handling**
- **Unified Context Interface**: API th·ªëng nh·∫•t cho t·∫•t c·∫£ c√°c adapters
- **Request Data Binding**: 
  - JSON binding v·ªõi validation
  - XML binding v√† parsing
  - Form data binding (application/x-www-form-urlencoded)
  - Multipart form data v·ªõi file upload support
  - Query parameter binding v·ªõi default values
  - URL parameter extraction
- **Response Helpers**:
  - JSON response v·ªõi automatic content-type
  - XML response formatting
  - String response v·ªõi template support
  - File serving v√† download
  - Redirect responses
  - Status code management
- **Header Management**: Get/Set HTTP headers
- **Cookie Management**: Secure cookie handling
- **Context Storage**: Key-value storage trong request lifecycle
- **Middleware Chain**: Next() function ƒë·ªÉ ƒëi·ªÅu khi·ªÉn middleware execution

### ‚úÖ **Router System - Advanced Routing**
- **Trie-Based Router**: High-performance routing v·ªõi trie data structure
- **Pattern Matching**:
  - Static routes (`/users`)
  - Parameter routes (`/users/:id`)
  - Wildcard routes (`/files/*filepath`)
  - Catch-all patterns
- **HTTP Methods**: H·ªó tr·ª£ t·∫•t c·∫£ HTTP methods (GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS)
- **Route Groups**: Nh√≥m routes v·ªõi common prefix v√† middleware
- **Middleware Integration**: Per-route v√† group-level middleware
- **Performance Optimization**: Zero-allocation routing cho static routes
- **Route Priority**: Intelligent route matching priority
- **Parameters Extraction**: Efficient parameter parsing v√† caching

### ‚úÖ **Adapter Pattern - Multi-Engine Support**
- **Adapter Interface**: Unified interface cho different HTTP engines
- **Net/HTTP Adapter**: 
  - Standard library integration
  - Full HTTP/1.1 support
  - WebSocket upgrade capability
  - TLS/SSL support
- **FastHTTP Adapter**: 
  - High-performance alternative
  - Zero-allocation optimizations
  - Custom context implementation
  - Advanced connection pooling
- **HTTP/2 Adapter**: 
  - HTTP/2 protocol support
  - Server push capabilities
  - Multiplexing support
- **QUIC Adapter**: 
  - QUIC protocol support
  - UDP-based transport
  - Future-ready implementation
- **Unified Adapter**: Fallback adapter cho compatibility

---

## ‚öôÔ∏è Configuration System

### ‚úÖ **YAML-Based Configuration**
- **Structured Configuration**: Comprehensive YAML configuration support
- **Environment-Specific Configs**: app.dev.yaml, app.prod.yaml, app.test.yaml
- **Environment Variable Override**: Override config values v·ªõi environment variables
- **Nested Configuration**: Complex nested configuration structures
- **Validation**: Configuration validation v·ªõi default values
- **Hot Reload**: Configuration reloading trong development mode

### ‚úÖ **WebApp Configuration**
- **Server Settings**: Host, port, timeouts configuration
- **Adapter Selection**: Runtime adapter switching
- **Middleware Configuration**: Global middleware setup
- **Static File Serving**: Static content configuration
- **Security Settings**: Security-related configurations
- **Performance Tuning**: Performance optimization settings

---

## üîß Dependency Injection Integration

### ‚úÖ **Service Provider Pattern**
- **ServiceProvider Interface**: Chu·∫©n h√≥a service registration v√† boot process
- **Container Integration**: T√≠ch h·ª£p v·ªõi go.fork.vn/di container
- **Service Registration**: Automatic service discovery v√† registration
- **Dependency Resolution**: Runtime dependency injection
- **Lifecycle Management**: Service lifecycle coordination
- **Configuration Injection**: Inject configuration v√†o services

### ‚úÖ **Built-in Service Providers**
- **WebApp Provider**: Register WebApp instance v√†o DI container
- **Router Provider**: Router service registration
- **Context Provider**: Context factory registration
- **Adapter Provider**: Adapter services registration

---

## üõ°Ô∏è Middleware Ecosystem

### ‚úÖ **YAML-Based Middleware Configuration**
- **Auto-Loading System**: Middleware t·ª± ƒë·ªông load t·ª´ YAML config
- **Zero-Code Configuration**: Enable middleware ch·ªâ v·ªõi `enabled: true`
- **Environment-Specific**: Different middleware configs cho t·ª´ng environment
- **Conditional Loading**: Load middleware based on conditions
- **Order Management**: Middleware execution order configuration

### ‚úÖ **Security & Authentication Middleware**
- **BasicAuth Middleware**: HTTP Basic Authentication v·ªõi user/password
- **Helmet Middleware**: Comprehensive security headers
  - XSS Protection
  - Content Type Options
  - Frame Options (Clickjacking protection)
  - HSTS (HTTP Strict Transport Security)
  - Content Security Policy
  - Referrer Policy
- **CORS Middleware**: Cross-Origin Resource Sharing
  - Origin validation
  - Methods v√† headers configuration
  - Credentials support
  - Preflight handling
- **CSRF Middleware**: Cross-Site Request Forgery protection
  - Token generation v√† validation
  - Cookie-based storage
  - Multiple token lookup methods
- **KeyAuth Middleware**: API key authentication
  - Header, query, form-based key lookup
  - Custom validation functions
  - Error handling customization

### ‚úÖ **Performance & Content Middleware**
- **Compression Middleware**: Response compression
  - Gzip compression support
  - Configurable compression levels
  - Content-type filtering
  - Size threshold configuration
- **Cache Middleware**: HTTP caching headers
  - ETag generation
  - Cache-Control headers
  - Conditional requests
  - Custom cache strategies
- **ETag Middleware**: Entity tag generation
  - Strong v√† weak ETags
  - Automatic generation
  - Conditional request handling
- **Static Middleware**: Static file serving
  - Directory browsing
  - Index file support
  - Cache headers
  - MIME type detection

### ‚úÖ **Rate Limiting & Control Middleware**
- **Limiter Middleware**: Rate limiting functionality
  - Request rate limiting
  - IP-based limiting
  - Custom key extraction
  - Memory-based storage
- **BodyLimit Middleware**: Request body size limiting
  - Configurable size limits
  - Different limits for different content types
  - Early termination for oversized requests
- **Method Middleware**: HTTP method validation
  - Allowed methods configuration
  - Method override support
- **Timeout Middleware**: Request timeout handling
  - Per-route timeout configuration
  - Graceful timeout responses

### ‚úÖ **Session & State Middleware**
- **Session Middleware**: HTTP session management
  - Cookie-based sessions
  - Multiple storage backends
  - Session lifetime management
  - Secure session handling
- **RequestID Middleware**: Request tracking
  - Unique request ID generation
  - Header injection
  - Logging integration

### ‚úÖ **Infrastructure & Utilities**
- **Logger Middleware**: Request/response logging
  - Structured logging support
  - Configurable log formats
  - Performance metrics logging
- **Recover Middleware**: Panic recovery
  - Graceful error handling
  - Stack trace logging
  - Custom error responses
- **Monitor Middleware**: Application monitoring
  - Request metrics collection
  - Performance monitoring
  - Health check support
- **Favicon Middleware**: Favicon serving optimization
- **Static Middleware**: Enhanced static file serving
- **Proxy Middleware**: Reverse proxy functionality
- **Redirect Middleware**: URL redirection
- **HealthCheck Middleware**: Health check endpoints

### ‚úÖ **Advanced Features Middleware**
- **Skip Middleware**: Conditional middleware execution
- **EarlyData Middleware**: HTTP/2 early data handling
- **EncryptCookie Middleware**: Cookie encryption/decryption
- **EnvVar Middleware**: Environment variable injection
- **ExpVar Middleware**: Go expvar metrics exposure
- **Idempotency Middleware**: Idempotent request handling
- **Rewrite Middleware**: URL rewriting

---

## üé® Template Engine Support

### ‚úÖ **Multi-Engine Template System**
- **Multiple Template Engines**: H·ªó tr·ª£ nhi·ªÅu template engines ƒë·ªìng th·ªùi
  - HTML templates (Go standard library)
  - Text templates
  - Pug templates
  - Mustache templates
  - Handlebars templates
  - Jet templates
- **YAML Configuration**: Complete template configuration via YAML
- **Layout System**: Master layouts v√† partial templates
- **Auto-Detection**: Automatic engine selection based on file extension
- **Template Caching**: Production-ready template caching
- **Auto-Reload**: Development mode auto-reload
- **Custom Functions**: Built-in v√† custom template functions
- **Context Integration**: Enhanced Fork Context v·ªõi automatic content-type detection

### ‚úÖ **Template Features**
- **Layouts v√† Partials**: Master layout v·ªõi reusable components
- **Template Inheritance**: Template inheritance patterns
- **Data Binding**: Strong-typed data binding
- **Error Handling**: Comprehensive error handling
- **Performance Optimization**: Template compilation v√† caching
- **Security**: Template security v·ªõi HTML escaping

---

## ‚ùå Error Handling System

### ‚úÖ **Structured Error Management**
- **HttpError Struct**: Standardized HTTP error structure
  - Status code management
  - Error message v√† details
  - Original error preservation
  - JSON serialization support
- **HTTP Status Code Coverage**: Complete HTTP status code support
  - **4xx Client Errors**: 400, 401, 403, 404, 405, 406, 409, 410, 415, 422, 429
  - **5xx Server Errors**: 500, 501, 502, 503, 504
- **Error Creation Helpers**: Convenient error creation functions
- **Error Response Formatting**: Consistent error response format
- **Integration Patterns**: Error handling integration v·ªõi middleware v√† validation

### ‚úÖ **Error Handling Features**
- **Global Error Handler**: Application-level error handling
- **Middleware Error Integration**: Error handling trong middleware chain
- **Validation Error Handling**: Structured validation error responses
- **Authentication Error Handling**: Auth-specific error responses
- **Rate Limiting Error Handling**: Rate limit exceeded responses
- **Security Best Practices**: Secure error message exposure
- **Logging Integration**: Error logging v√† monitoring

---

## üìñ Documentation & Examples

### ‚úÖ **Comprehensive Vietnamese Documentation**
- **Getting Started Guide**: 12-section comprehensive overview guide
- **Core Components Documentation**:
  - Configuration System (config.md)
  - Service Provider & DI (service-provider.md)
  - Web Application (web-application.md)
  - Context, Request & Response (context-request-response.md)
  - Router System (router.md)
  - Adapter Pattern (adapter.md)
- **Advanced Features Documentation**:
  - Middleware System (middleware.md) - 30+ middleware packages
  - Error Handling (error-handling.md) - Comprehensive error management
  - Template Engine (templates integration)
- **Navigation & Reference**:
  - Documentation Index (index.md)
  - Complete API Reference
  - Project README (README.md)

### ‚úÖ **Real-World Examples**
- **Basic Examples**: Hello World v√† simple applications
- **Adapter Examples**: Examples cho t·ª´ng adapter type
- **Middleware Integration**: Real-world middleware usage
- **Template Examples**: Multi-engine template examples
- **Production Examples**: Production-ready application setups
- **Testing Examples**: Unit v√† integration testing patterns

### ‚úÖ **Best Practices Documentation**
- **Project Structure**: Recommended project organization
- **Security Best Practices**: Security configuration v√† patterns
- **Performance Optimization**: Performance tuning guidelines
- **Testing Strategies**: Unit, integration, v√† performance testing
- **Deployment Patterns**: Docker, Kubernetes deployment
- **Monitoring Setup**: Observability v√† monitoring configuration

---

## üöÄ Performance & Production Features

### ‚úÖ **High Performance**
- **Zero-Allocation Routing**: Optimized routing v·ªõi minimal allocations
- **Connection Pooling**: Efficient connection management
- **Memory Management**: Object pooling v√† reuse
- **Async Processing**: Non-blocking request processing
- **Adapter-Specific Optimizations**: Performance tuning cho t·ª´ng adapter

### ‚úÖ **Production-Ready Features**
- **Graceful Shutdown**: Clean application shutdown
- **Health Checks**: Built-in health check endpoints
- **Metrics Collection**: Application metrics v√† monitoring
- **Security Headers**: Comprehensive security header support
- **Request Tracking**: Request ID tracking v√† correlation
- **Error Recovery**: Panic recovery v√† error handling
- **Configuration Validation**: Runtime configuration validation

### ‚úÖ **Deployment Support**
- **Docker Integration**: Docker deployment patterns
- **Kubernetes Support**: K8s deployment configurations
- **Environment Management**: Multi-environment configuration
- **Secret Management**: Secure secret handling
- **CI/CD Integration**: GitHub Actions workflows
- **Monitoring Integration**: Prometheus metrics, distributed tracing

---

## üîß Development Experience

### ‚úÖ **Developer-Friendly Features**
- **Hot Reload**: Development mode hot reloading
- **Detailed Error Messages**: Comprehensive error reporting
- **Auto-Configuration**: Minimal configuration requirements
- **Extensive Logging**: Debug v√† development logging
- **Testing Utilities**: Built-in testing helpers
- **Documentation**: Complete API documentation

### ‚úÖ **Integration Ecosystem**
- **Third-Party Integration**: Easy integration v·ªõi external libraries
- **Plugin Architecture**: Extensible plugin system
- **Custom Middleware**: Simple custom middleware development
- **Custom Adapters**: Custom adapter implementation support
- **Service Integration**: Easy service integration patterns

---

## üì¶ Package Structure

```
go.fork.vn/fork/
‚îú‚îÄ‚îÄ adapter/           # HTTP adapter implementations
‚îÇ   ‚îú‚îÄ‚îÄ adapter.go     # Base adapter interface
‚îÇ   ‚îî‚îÄ‚îÄ README.md      # Adapter documentation
‚îú‚îÄ‚îÄ context/           # Request/response context system
‚îÇ   ‚îú‚îÄ‚îÄ context.go     # Main context implementation
‚îÇ   ‚îú‚îÄ‚îÄ request.go     # Request handling
‚îÇ   ‚îú‚îÄ‚îÄ response.go    # Response helpers
‚îÇ   ‚îî‚îÄ‚îÄ *_test.go      # Comprehensive tests
‚îú‚îÄ‚îÄ docs/              # Complete documentation
‚îÇ   ‚îú‚îÄ‚îÄ overview.md    # Getting started guide
‚îÇ   ‚îú‚îÄ‚îÄ config.md      # Configuration documentation
‚îÇ   ‚îú‚îÄ‚îÄ *.md           # Component documentation
‚îÇ   ‚îî‚îÄ‚îÄ index.md       # Documentation index
‚îú‚îÄ‚îÄ errors/            # Error handling system
‚îÇ   ‚îú‚îÄ‚îÄ errors.go      # HttpError implementation
‚îÇ   ‚îî‚îÄ‚îÄ errors_test.go # Error handling tests
‚îú‚îÄ‚îÄ router/            # Advanced routing system
‚îÇ   ‚îú‚îÄ‚îÄ router.go      # Main router implementation
‚îÇ   ‚îú‚îÄ‚îÄ trie.go        # Trie data structure
‚îÇ   ‚îî‚îÄ‚îÄ *_test.go      # Router tests
‚îú‚îÄ‚îÄ configs/           # Configuration examples
‚îÇ   ‚îî‚îÄ‚îÄ app.example.yaml
‚îú‚îÄ‚îÄ web_app.go         # Main WebApp implementation
‚îú‚îÄ‚îÄ config.go          # Configuration management
‚îú‚îÄ‚îÄ provider.go        # Service provider implementation
‚îú‚îÄ‚îÄ constants.go       # Framework constants
‚îú‚îÄ‚îÄ doc.go             # Package documentation
‚îú‚îÄ‚îÄ go.mod             # Module dependencies
‚îú‚îÄ‚îÄ README.md          # Project README
‚îî‚îÄ‚îÄ LICENSE            # MIT License
```

---

## üéØ Key Dependencies

### Core Dependencies
- **go.fork.vn/config v0.1.2**: YAML configuration management
- **go.fork.vn/di v0.1.0**: Dependency injection container
- **go.fork.vn/log v0.1.0**: Structured logging
- **github.com/go-playground/validator/v10**: Request validation
- **golang.org/x/net**: Network utilities
- **gopkg.in/yaml.v3**: YAML parsing

### Framework Features
- **YAML-First Configuration**: All configuration through YAML files
- **Auto-Loading Middleware**: Zero-code middleware configuration
- **Multiple HTTP Adapters**: net/http, FastHTTP, HTTP/2, QUIC support
- **Comprehensive Middleware**: 30+ production-ready middleware packages
- **Template Engine Support**: Multiple template engines v·ªõi YAML config
- **Structured Error Handling**: Complete HTTP error management
- **Production-Ready**: Graceful shutdown, health checks, monitoring

---

## üèÅ Next Steps & Roadmap

### Immediate Improvements
- üîÑ WebSocket support implementation
- üîÑ GraphQL adapter development  
- üîÑ Enhanced metrics collection
- üîÑ Advanced authentication middleware (JWT, OAuth2)
- üîÑ Content negotiation middleware

### Future Enhancements
- üîÑ gRPC adapter support
- üîÑ Distributed tracing integration
- üîÑ Advanced caching strategies
- üîÑ Plugin ecosystem expansion
- üîÑ Performance benchmarking tools

---

## ü§ù Contributing

Ch√∫ng t√¥i hoan ngh√™nh contributions t·ª´ community! Vui l√≤ng ƒë·ªçc [CONTRIBUTING.md](CONTRIBUTING.md) ƒë·ªÉ bi·∫øt c√°ch contribute v√†o project.

## üìÑ License

Project n√†y ƒë∆∞·ª£c ph√°t h√†nh d∆∞·ªõi [MIT License](LICENSE).

## üôè Acknowledgments

C·∫£m ∆°n t·∫•t c·∫£ contributors v√† community ƒë√£ h·ªó tr·ª£ ph√°t tri·ªÉn Fork HTTP Framework!

---

**Fork HTTP Framework v0.0.9** - Build powerful, scalable web applications with Go! üöÄ
